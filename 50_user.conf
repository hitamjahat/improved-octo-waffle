#### meta start
#### project Whonix
#### category tor and networking
#### gateway_only yes
#### description
## Tor settings for Gateway: `ClientOnionAuthDir`, `SocksPort`s, `TransPort`,
## `DnsPort`, `HTTPTunnelPort`s and stream isolation settings.
#### meta end

########################
# Tor Control Protocol #
########################

## Required for onion-grater. See /usr/lib/onion-grater for the comment
## including the following link:
## https://gitlab.torproject.org/tpo/core/tor/-/issues/25173
## File /usr/share/tor/tor-service-defaults-torrc also contains Tor control
## protocol specific settings.
ControlPort 9352

###################################
# Authenticated Onion v3 Services #
###################################

## anon-gw-anonymizer-config.service /
## /usr/libexec/anon-gw-anonymizer-config/make-sure-torrc-exist
## creates folder /var/lib/tor/authdir
ClientOnionAuthDir /var/lib/tor/authdir

###########################
# Gateway Trans/Dns-Port #
###########################

# TransPort and DnsPort are not enabled in gateway firewall by default.
##
# (comment mirrored from /usr/bin/whonix_firewall)
# Transparent Proxy Ports for Whonix-Gateway
# TRANS_PORT_GATEWAY="9341"
# DNS_PORT_GATEWAY="5700"
TransPort 127.0.0.1:9341
DnsPort 127.0.0.1:5700

#######################
# Gateway SocksPorts #
#######################

# Developer comment:
##
# We actually do not need all of them,
# but they do not hurt anyway and
# it keeps the setup more generic,
# with less exceptions.
##
# Comments why we (not) use IsolateDestAddr and/or IsolateDestPort
# are the same as in section Workstation SocksPorts.

## /usr/share/tor/tor-service-defaults-torrc contains 'SocksPort unix:/run/tor/socks WorldWritable' too.
## Have to add here too. Syntax is non-intuitive.
## https://www.whonix.org/wiki/Tor#Additional_SocksPorts
## https://trac.torproject.org/projects/tor/ticket/15261
SocksPort unix:/run/tor/socks WorldWritable

SocksPort 127.0.0.1:9350

SocksPort 127.0.0.1:9400
SocksPort 127.0.0.1:9401 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9402 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9403 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9404
SocksPort 127.0.0.1:9405 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9406 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9407 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9408 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9409 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9410 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9411
#SocksPort 127.0.0.1:9412
#SocksPort 127.0.0.1:9413
SocksPort 127.0.0.1:9414 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9415 IsolateDestAddr IsolateDestPort
#SocksPort 127.0.0.1:9416
SocksPort 127.0.0.1:9417 IsolateDestAddr IsolateDestPort
SocksPort 127.0.0.1:9418 IsolateDestAddr IsolateDestPort
#SocksPort 127.0.0.1:9419
#SocksPort 127.0.0.1:9420
#SocksPort 127.0.0.1:9421
SocksPort 127.0.0.1:9422
SocksPort 127.0.0.1:9423
SocksPort 127.0.0.1:9424
SocksPort 127.0.0.1:9425
SocksPort 127.0.0.1:9450 IPv6Traffic PreferIPv6 KeepAliveIsolateSOCKSAuth

##########################
# Gateway HTTPTunnelPort #
##########################

# without IsolateDestAddr
# without IsolateDestPort
HTTPTunnelPort 127.0.0.1:9490
HTTPTunnelPort 127.0.0.1:9491
HTTPTunnelPort 127.0.0.1:9492
HTTPTunnelPort 127.0.0.1:9493
HTTPTunnelPort 127.0.0.1:9494
HTTPTunnelPort 127.0.0.1:9495
HTTPTunnelPort 127.0.0.1:9496
HTTPTunnelPort 127.0.0.1:9497
HTTPTunnelPort 127.0.0.1:9498
HTTPTunnelPort 127.0.0.1:9499

# with IsolateDestAddr
# without IsolateDestPort
HTTPTunnelPort 127.0.0.1:9500 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9501 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9502 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9503 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9504 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9505 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9506 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9507 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9508 IsolateDestAddr
HTTPTunnelPort 127.0.0.1:9509 IsolateDestAddr

# without IsolateDestAddr
# with IsolateDestPort
HTTPTunnelPort 127.0.0.1:9510 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9511 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9512 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9513 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9514 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9515 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9516 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9517 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9518 IsolateDestPort
HTTPTunnelPort 127.0.0.1:9519 IsolateDestPort

# with IsolateDestAddr
# with IsolateDestPort
HTTPTunnelPort 127.0.0.1:9520 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9521 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9522 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9523 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9524 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9525 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9526 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9527 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9528 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 127.0.0.1:9529 IsolateDestAddr IsolateDestPort

## You can find the original upstream tor-service-defaults-torrc under
## /usr/share/tor/tor-service-defaults-torrc

#### meta start
#### project Whonix
#### category tor and networking
#### gateway_only yes
#### description
## Tor is disabled by default.
## Users are supposed to enable Tor through setup-dist which would
## create file /usr/local/etc/torrc.d/40_tor_control_panel.conf with
## "DisableNetwork 0" or by removing the hash ('#') in front of
## "DisableNetwork 0" in /usr/local/etc/torrc.d/40_tor_control_panel.conf
DisableNetwork 1

VirtualAddrNetwork 10.192.0.0/10
AutomapHostsOnResolve 1

Log notice file /run/tor/log
#### meta end

#### meta start
#### project Whonix
#### category tor and networking
#### gateway_only yes
#### description
## Tor settings for Workstation: `SocksPort`s, `TransPort`,
## `DnsPort`, `HTTPTunnelPort`s and stream isolation settings.
## IP HARDCODED unfortunately.
#### meta end

###############################
# Workstation Trans/Dns-Port  #
###############################

# (comment mirrored from /usr/bin/whonix_firewall)
# Transparent Proxy Port for Workstation
# TRANS_PORT_WORKSTATION="9340"
#
# TransPort is not used for anything preinstalled by default.
# Only as a catch all for user installed applications,
# which is documented.
#
# IsolateDestAddr should not be activated by default,
# if people install filesharing software it would be a nightmare if all connections to the massive amount
# of destination IP's would go through separate circuits.
#
# For the same reason IsolateDestPort should not be activated by default, since BitTorrent (in some cases)
# uses random ports.
#
# https://lists.torproject.org/pipermail/tor-dev/2018-June/013236.html
# Isolation settings summary:
# * All the isolation flags that aren't specified as defaults are not defaults.
# * Different socksports/transports are isolated from each other by default, IsolateClientProtocol would
# violate this.
# * IsolateDest + DNSPort negatively impacts performance, network resources and privacy.
# * SOCKSPort/HTTPTunnelPort are recommended, they include DNS requests in each connection's outgoing data
# respectively.
TransPort 10.152.152.10:9340

# (comment mirrored from /usr/bin/whonix_firewall)
# DNS_PORT_WORKSTATION="5600"
#
# DnsPort is not used for anything preinstalled by default.
# Only as a catch all for user installed applications,
# which is documented.
#
# Not listening on port 53 but rather on a port higher than 1024 to avoid
# issues with reloading Tor. (Tor drops privileges and is then unable to
# create listeners below 1024.)
#
# Not sure about IsolateDestAddr.
# IsolateDestPort has probably very little effect, since most DNS servers listen on port 53.
DnsPort 10.152.152.10:5600 IsolateDestPort

###########################
# Workstation SocksPorts #
###########################

# (comment mirrored from /usr/bin/whonix_firewall)
# Socks Ports for per application circuits.
# SOCKS_PORT_TOR_DEFAULT="9350"
# SOCKS_PORT_TB="9400"
# SOCKS_PORT_IRC="9401"
# SOCKS_PORT_TORBIRDY="9402"
# SOCKS_PORT_IM="9403"
# SOCKS_PORT_APT_GET="9404"
# SOCKS_PORT_GPG="9405"
# SOCKS_PORT_SSH="9406"
# SOCKS_PORT_GIT="9407"
# SOCKS_PORT_SDWDATE="9408"
# SOCKS_PORT_WGET="9409"
# SOCKS_PORT_SYSTEMCHECK="9410"
# SOCKS_PORT_BITCOIN="9411"
## 9412
## 9413
# SOCKS_PORT_WHONIX_NEWS="9414"
# SOCKS_PORT_TBB_DOWNLOAD="9415"
## 9416
# SOCKS_PORT_CURL="9417"
# SOCKS_PORT_RSS="9418"
## 9419
## 9420
## 9421
# SOCKS_PORT_KDE="9422"
# SOCKS_PORT_GNOME="9423"
# SOCKS_PORT_APTITUDE="9424"
# SOCKS_PORT_YUM="9425"
# SOCKS_PORT_TBB_DEFAULT="9450"

# Tor Default Port
# Only for applications, which expect Tor to be running on port 9050.
SocksPort 10.152.152.10:9350

# legacy
SocksPort 10.152.152.10:9400

# IRC: HexChat
# People are normally not connected to too many IRC servers,
# so they can use one circuit per server.
SocksPort 10.152.152.10:9401 IsolateDestAddr IsolateDestPort

# Mail: Thunderbird (previously with TorBirdy)
# (Mentioning TorBirdy so this can be discovered through search.)
# Not used by too many people. Most users do not connect to
# too many servers.
SocksPort 10.152.152.10:9402 IsolateDestAddr IsolateDestPort

# Instant Messenger (IM)
# People are normally not connected to too many IM servers,
# so they can use one circuit per server.
SocksPort 10.152.152.10:9403 IsolateDestAddr IsolateDestPort

# Operating system updates: apt-get
# Not using IsolateDestAddr IsolateDestPort, because too much
# performance loss, too much load on Tor network and no gain
# in security.
SocksPort 10.152.152.10:9404

# gpg
# Not used by too many people. Most users do not connect to
# too many servers.
SocksPort 10.152.152.10:9405 IsolateDestAddr IsolateDestPort

# ssh
# Not used by too many people. Most users do not connect to
# too many servers.
SocksPort 10.152.152.10:9406 IsolateDestAddr IsolateDestPort

# git
# Not preinstalled.
# Not used by too many people. Most users do not connect to
# too many servers.
SocksPort 10.152.152.10:9407 IsolateDestAddr IsolateDestPort

# sdwdate Network Time Synchronization
# There are only three different connections.
SocksPort 10.152.152.10:9408 IsolateDestAddr IsolateDestPort

# command line downloader: wget
# Only manually and by very few applications used. Should not
# hurt performance or Tor network. Very few connections are
# expected.
SocksPort 10.152.152.10:9409 IsolateDestAddr IsolateDestPort

# systemcheck
# Only connects to https://check.torproject.org and checks IP.
# Only one server and only one port.
# Would be fine without IsolateDestAddr IsolateDestPort,
# but add it anyway to have less exceptions.
SocksPort 10.152.152.10:9410 IsolateDestAddr IsolateDestPort

# Bitcoin electrum wallet
# Not using IsolateDestAddr IsolateDestPort.
# Makes too many connections to different servers. Should not
# hurt if they get through the same circuit.
SocksPort 10.152.152.10:9411

#SocksPort 10.152.152.10:9412
#SocksPort 10.152.152.10:9413

# Whonix news download
# Only connects to the Whonix homepage and downloads a small file with
# latest important Whonix news.
# Only one server and only one port.
# Would be fine without IsolateDestAddr IsolateDestPort,
# but add it anyway to have less exceptions.
SocksPort 10.152.152.10:9414 IsolateDestAddr IsolateDestPort

# Tor Browser bundle download
# Rarely used.
# Only one server and only one port.
# Would be fine without IsolateDestAddr IsolateDestPort,
# but add it anyway to have less exceptions.
SocksPort 10.152.152.10:9415 IsolateDestAddr IsolateDestPort

#SocksPort 10.152.152.10:9416

# Curl
# Only manually and by very few applications used. Should not
# hurt performance or Tor network. Very few connections are
# expected.
SocksPort 10.152.152.10:9417 IsolateDestAddr IsolateDestPort

# RSS
SocksPort 10.152.152.10:9418 IsolateDestAddr IsolateDestPort

#SocksPort 10.152.152.10:9419

#SocksPort 10.152.152.10:9420

#SocksPort 10.152.152.10:9421

# KDE application wide proxy.
# Not using IsolateDestAddr or IsolateDestPort, because also browsers
# could use this port.
SocksPort 10.152.152.10:9422

# GNOME application wide proxy.
# This port is currently not in use.
# Not using IsolateDestAddr or IsolateDestPort, because also browsers
# could use this port.
SocksPort 10.152.152.10:9423

# Operating system updates: aptitude
# Not using IsolateDestAddr IsolateDestPort, because too much
# performance loss, too much load on Tor network and no gain
# in security.
SocksPort 10.152.152.10:9424

# Operating system updates: yum
# Not using IsolateDestAddr IsolateDestPort, because too much
# performance loss, too much load on Tor network and no gain
# in security.
SocksPort 10.152.152.10:9425

# Tor Browser Bundle Default Port
# This port gets used if someone uses the default Tor Browser Bundle.
# (anon-ws-disable-stacked-tor runs on Workstation and forwards connections from
#  127.0.0.1:9450 to 10.152.152.10:9450.)
# Not using IsolateDestAddr IsolateDestPort, because too much
# performance loss, too much load on Tor network and not secure.
# Instead Tor Browser sets SOCKS username for a request based on first party domain.
# https://trac.torproject.org/projects/tor/ticket/3455
SocksPort 10.152.152.10:9450 IPv6Traffic PreferIPv6 KeepAliveIsolateSOCKSAuth ExtendedErrors

# Custom Ports #1:
# without IsolateDestAddr
# without IsolateDestPort
SocksPort 10.152.152.10:9452
SocksPort 10.152.152.10:9453
SocksPort 10.152.152.10:9454
SocksPort 10.152.152.10:9455
SocksPort 10.152.152.10:9456
SocksPort 10.152.152.10:9457
SocksPort 10.152.152.10:9458
SocksPort 10.152.152.10:9459

# Custom Ports #2:
# with IsolateDestAddr
# without IsolateDestPort
SocksPort 10.152.152.10:9460 IsolateDestAddr
SocksPort 10.152.152.10:9461 IsolateDestAddr
SocksPort 10.152.152.10:9462 IsolateDestAddr
SocksPort 10.152.152.10:9463 IsolateDestAddr
SocksPort 10.152.152.10:9464 IsolateDestAddr
SocksPort 10.152.152.10:9465 IsolateDestAddr
SocksPort 10.152.152.10:9466 IsolateDestAddr
SocksPort 10.152.152.10:9467 IsolateDestAddr
SocksPort 10.152.152.10:9468 IsolateDestAddr
SocksPort 10.152.152.10:9469 IsolateDestAddr

# Custom Ports #3:
# without IsolateDestAddr
# with IsolateDestPort
SocksPort 10.152.152.10:9470 IsolateDestPort
SocksPort 10.152.152.10:9471 IsolateDestPort
SocksPort 10.152.152.10:9472 IsolateDestPort
SocksPort 10.152.152.10:9473 IsolateDestPort
SocksPort 10.152.152.10:9474 IsolateDestPort
SocksPort 10.152.152.10:9475 IsolateDestPort
SocksPort 10.152.152.10:9476 IsolateDestPort
SocksPort 10.152.152.10:9477 IsolateDestPort
SocksPort 10.152.152.10:9478 IsolateDestPort
SocksPort 10.152.152.10:9479 IsolateDestPort

# Custom Ports #4:
# with IsolateDestAddr
# with IsolateDestPort
SocksPort 10.152.152.10:9480 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9481 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9482 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9483 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9484 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9485 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9486 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9487 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9488 IsolateDestAddr IsolateDestPort
SocksPort 10.152.152.10:9489 IsolateDestAddr IsolateDestPort

##############################
# Workstation HTTPTunnelPort #
##############################

# without IsolateDestAddr
# without IsolateDestPort
HTTPTunnelPort 10.152.152.10:9490
HTTPTunnelPort 10.152.152.10:9491
HTTPTunnelPort 10.152.152.10:9492
HTTPTunnelPort 10.152.152.10:9493
HTTPTunnelPort 10.152.152.10:9494
HTTPTunnelPort 10.152.152.10:9495
HTTPTunnelPort 10.152.152.10:9496
HTTPTunnelPort 10.152.152.10:9497
HTTPTunnelPort 10.152.152.10:9498
HTTPTunnelPort 10.152.152.10:9499

# with IsolateDestAddr
# without IsolateDestPort
HTTPTunnelPort 10.152.152.10:9500 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9501 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9502 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9503 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9504 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9505 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9506 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9507 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9508 IsolateDestAddr
HTTPTunnelPort 10.152.152.10:9509 IsolateDestAddr

# without IsolateDestAddr
# with IsolateDestPort
HTTPTunnelPort 10.152.152.10:9510 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9511 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9512 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9513 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9514 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9515 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9516 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9517 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9518 IsolateDestPort
HTTPTunnelPort 10.152.152.10:9519 IsolateDestPort

# with IsolateDestAddr
# with IsolateDestPort
HTTPTunnelPort 10.152.152.10:9520 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9521 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9522 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9523 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9524 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9525 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9526 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9527 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9528 IsolateDestAddr IsolateDestPort
HTTPTunnelPort 10.152.152.10:9529 IsolateDestAddr IsolateDestPort

UseBridges 1
ClientTransportPlugin obfs2,obfs3 exec /usr/bin/obfsproxy managed
ClientTransportPlugin obfs4 exec /usr/bin/obfs4proxy

bridge obfs4 157.90.32.222:6688 81AFBD3C921CEC6E17B8185DAD7747D2C244BFB4 cert=i27jIPhihFrC4h6f9QdJ/vCKmkIMs+ikTYeUs4pwlurYjLAYSDiI+iAVmSVVCmvM4meLfw iat-mode=0
bridge obfs4 69.235.46.22:30913 F79914011EB368C94E58F6CCF8A55A92EFD5F496 cert=ZKLm+4biqgPIf/g1s3slv8jLSzIzLSXAHFOfBLqtrNvnTM6LVbxe/K8e8jJKiXwOpvkoDw iat-mode=0
bridge obfs4 213.108.110.149:7499 519344140473CF91030B08F91521F9A6C144ED6C cert=k9fSL/d491qAkGmi2VeSwVlfuyO02jBeN54qxzzQISxpfm3b+a6kJpo8/Bfy1ACbHZIJUg iat-mode=0
